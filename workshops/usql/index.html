
<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,user-scalable=yes">
<meta name="theme-color" content="#4F7DC9">
<meta charset="UTF-8">
<title>Advanced USQL</title>
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
<link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="../../elements/codelab-elements/codelab-elements.css">
<style>
.success{color:#1e8e3e}.error{color:red} </style>
</head>
<body>
<google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
<google-codelab codelab-gaid="UA-175467274-1" id="usql" title="Advanced USQL" environment="web" feedback-link="mailto:APAC-SE-Central@dynatrace.com">
<google-codelab-step label="Introduction" duration="0">
<p> This repository contains the exercises for the Advanced USQL session. </p>
<h2 is-upgraded>Prerequisites </h2>
<ul>
<li>Access to http://demo.live.dynatrace.com </li>
<li>Microsoft Excel <h2 class="checklist" is-upgraded>What You&#39;ll Learn </h2>
</li>
<li>Intricacies/Gotchas of USQL </li>
<li>USQL Tips and tricks in the field </li>
<li>Extracting and manupulating the data in Excel </li>
<li>Some advanced USQL for BizOps use cases Intricacies/Gotchas of USQL <h2 is-upgraded>Warm up </h2>
What does each of the query do? Go ahead to run this in http://demo.live.dynatrace.com -&gt; User sessions <strong>Query 1</strong><code>select distinct hour(usersession.starttime), count(*) from usersession order by count(*) DESC</code><strong>Query 2</strong><code>select distinct hour(usersession.starttime), count(useraction.name) from usersession order by count(useraction.name) DESC</code><strong>Query 3</strong><code>select distinct hour(usersession.starttime), count(useraction.name) from useraction order by count(useraction.name) DESC</code><h2 is-upgraded>Challenge </h2>
</li>
<li>What does each of the query do? </li>
<li>What are we actually querying for? <strong>Hint</strong>: Focus on the table name, and condition <code>useraction.name like &#34;%rest%&#34;</code><strong>Query 1</strong><code>SELECT useraction.name as &#34;Page Name&#34;, COUNT(*) as &#34;Page Views&#34;, COUNT(DISTINCT usersession.internalUserId) AS &#34;Unique Page Views&#34;, AVG(useraction.duration) As &#34;Average Session&#34; FROM usersession WHERE useraction.name like &#34;%rest%&#34; GROUP BY useraction.name</code><strong>Case in point:</strong><code>select useraction.name from usersession LIMIT 10</code><strong>Query 2</strong><code>SELECT useraction.name as &#34;Page Name&#34;, COUNT(*) as &#34;Page Views&#34;, COUNT(DISTINCT usersession.internalUserId) AS &#34;Unique Page Views&#34;, AVG(useraction.duration) As &#34;Average Session&#34; FROM useraction WHERE useraction.name like &#34;%rest%&#34; GROUP BY useraction.name</code>Hands on exercise <h2 is-upgraded>Setting up the query </h2>
</li>
</ul>
<ol type="1">
<li>Access: </li>
<li>Launch API V1 <img alt="API" src="img/491c6fda4994c405.png"></li>
<li>Authenticate <img alt="API" src="img/e59a6ab35b15cee4.png"></li>
<li>Go to User Sessions </li>
<li>Expand /userSessionQueryLanguage/tree (DO NOT USE TABLE) </li>
<li>Click try it out </li>
<li>Enter in your query <code>select useraction.name from usersession</code><img alt="API" src="img/c18d53c5c2a4cee0.png"></li>
<li>Execute </li>
<li>Copy Request URL <img alt="API" src="img/18cf47e365e5d967.png"><h2 is-upgraded>Using Excel to slice and dice the data </h2>
</li>
<li>Open new spreadsheet, select Data and then select From Web <img alt="Excel" src="img/dfd2ed6cf1131572.png"></li>
<li>Insert Request URL w/ token as a query parameter (use &amp;pageSize=[N] to expand result set) <code>&amp;pageSize=50000&amp;api-token=[YourToken]</code> Example: <code>https://&lt;URL&gt;/e/&lt;envid&gt;/api/v1/userSessionQueryLanguage/tree?query=select%20useraction.name%20from%20usersession&amp;addDeepLinkFields=false&amp;explain=false&amp;pageSize=50000&amp;api-token=[YourToken]</code><img alt="Excel" src="img/11494cc7d7d31321.png"></li>
<li>Click OK </li>
<li>Select List (next to values) <img alt="Excel" src="img/52bf8d90e584af5a.png"></li>
<li>Select List again <img alt="Excel" src="img/39b30e33815141c1.png"></li>
<li>Select To Table Convert (Delimiter None) <img alt="Excel" src="img/59db27f04f32267a.png"></li>
<li>Click expand icon in Value header </li>
<li>Extract values (Delimiter â€“ comma) <img alt="Excel" src="img/ef5aec9a684ca1d0.png"></li>
<li>Click Close &amp; Load <img alt="Excel" src="img/7e0fea17bcae7ddb.png"></li>
<li>Highlight Column A and Insert-&gt;Pivot Table <img alt="Excel" src="img/42025c4bfd8b2da1.png"><img alt="Excel" src="img/73555b8852791f84.png"></li>
<li>Select box for Column 1 and drag Column 1 to Values <img alt="Excel" src="img/35617be6cb4e7a3d.png"></li>
<li>Select a value in Column B and sort Largest to Smallest. Resize Column A as neccessary <img alt="Excel" src="img/a293f3c6eb1f7ffb.png"> Final Result <img alt="Excel" src="img/9b5829b497989c74.png"></li>
<li>Save spreadsheet Advanced USQL for BizOps use cases <h2 is-upgraded>FUNNEL Query </h2>
<code>Bash<br>SELECT FUNNEL(useraction.name=&#34;Loading of page /easytravel/home&#34; AS &#34;Home&#34;, <br>useraction.name = &#34;/easytravel/rest/login&#34; AS &#34;LOGIN&#34;,<br>useraction.name = &#34;/easytravel/rest/locations&#34; AS &#34;Search&#34;, <br>useraction.matchingConversionGoals = &#34;Credit card validated&#34; AS &#34;Payment&#34;) <br>FROM usersession<br></code><img alt="Adv" src="img/f52b6fe0278c95a4.png"><h2 is-upgraded>FILTER Query </h2>
<strong>Use Case:</strong> I want all the user sessions &amp; avg(duration) that hit validate credit card and the avg duration for all user actions is longer than 2 seconds. Query <code>Bash<br>SELECT usersession.usersessionid, avg(useraction.duration)<br>FROM usersession<br>WHERE useraction.application=&#39;www.angular.easytravel.com&#39;<br>AND useraction.duration&gt;2000<br>AND useraction.name=&#34;/easytravel/rest/validate-creditcard&#34;<br>GROUP BY usersession.usersessionid</code><br> Result: If <strong>any one</strong> of user action in the session has duration&gt;2 seconds So if we pull from <code>useraction</code> table, will it give us what we want? <code>Bash<br>SELECT usersession.usersessionid, avg(useraction.duration)<br>FROM useraction<br>WHERE useraction.application=&#39;www.angular.easytravel.com&#39;<br>AND useraction.duration&gt;2000<br>AND useraction.name=&#34;/easytravel/rest/validate-creditcard&#34;<br>GROUP BY usersession.usersessionid</code><br> Looks better. <img alt="Adv" src="img/1b50da6a94e36fcd.png"> But am I getting the result that I want? Take any Usersession ID... <code>SELECT usersession.usersessionid FROM usersession WHERE usersession.usersessionid=&lt;anyid&gt;</code><img alt="Adv" src="img/79453cbf08e754e2.png"> What is the average user action duration here? (i.e. SUM(useraction duration) divide by total number of user actions) What I really want: average user action &gt;2 sec for <strong>every</strong> usersession. <strong>Solution</strong> If avg of <strong>all</strong> user actions duration&gt;2 seconds <code>Bash<br>SELECT usersession.usersessionid, avg(useraction.duration) FILTER&gt;2000<br>FROM usersession<br>WHERE useraction.application=&#39;www.angular.easytravel.com&#39;<br>AND useraction.name=&#34;/easytravel/rest/validate-creditcard&#34;<br>GROUP BY usersession.usersessionid<br></code><img alt="Adv" src="img/18f77f33d981aeaa.png"> Take any Usersession ID... <code>SELECT usersession.usersessionid FROM usersession WHERE usersession.usersessionid=&lt;anyid&gt;</code><img alt="Adv" src="img/8d176024eced570d.png"> (9.46+0.133+0.145+1.35+0.602+0.727+0.27+3.33)/8 = 2.0002 GOAL! Feedback <google-codelab-survey survey-id="usql-1">
<h4>How was your overall experience with this lab?</h4>
<paper-radio-group>
<paper-radio-button>Excellent</paper-radio-button>
<paper-radio-button>Good</paper-radio-button>
<paper-radio-button>Average</paper-radio-button>
<paper-radio-button>Fair</paper-radio-button>
<paper-radio-button>Poor</paper-radio-button>
</paper-radio-group>
</google-codelab-survey>
<google-codelab-survey survey-id="usql-2">
<h4>What did you benefit most from this lab?</h4>
<paper-radio-group>
<paper-radio-button>USQL tips and ticks in the field</paper-radio-button>
<paper-radio-button>Hands on exercise</paper-radio-button>
</paper-radio-group>
</google-codelab-survey>
Positive </li>
</ol>
<p>ðŸ’¡ For other ideas and suggestions, please <a href="mailto:APAC-SE-Central@dynatrace.com?subject=Kubernetes Workshop - Ideas and Suggestions" target="_blank"><strong>reach out via email</strong></a>.</p>
</google-codelab-step>
</google-codelab>
<script src="../../elements/codelab-elements/native-shim.js"></script>
<script src="../../elements/codelab-elements/custom-elements.min.js"></script>
<script src="../../elements/codelab-elements/prettify.js"></script>
<script src="../../elements/codelab-elements/codelab-elements.js"></script>
<script src="//support.google.com/inapp/api.js"></script>
</body>
</html>
