"use strict";const childprocess=require("child_process"),path=require("path"),spawn=childprocess.spawn,GZIP_TYPES="css,html,ico,js,json,svg,xml",ALWAYS_EXCLUDE="\\.git.*|\\.DS_Store",HEADER_CACHE_CONTROL="Cache-Control:public,max-age=3600";exports.rsync=((e,s,r={},t)=>{const l=[];r&&r.exclude?l.push("-x",`${r.exclude}|${ALWAYS_EXCLUDE}`):l.push("-x",ALWAYS_EXCLUDE),r&&r.dry&&l.push("-n"),r&&r.deleteMissing&&l.push("-d"),spawn("gsutil",["-o","GSUtil:parallel_process_count=8","-o","GSUtil:parallel_thread_count=1","-h",HEADER_CACHE_CONTROL,"-m","rsync","-c","-C","-j",GZIP_TYPES,"-r",...l,e,s],{stdio:"inherit"}).on("close",e=>{if(e)throw new Error(e);t()})}),exports.bucketName=((e,s)=>("gs://"!==(e=e||s).substring(0,5)&&(e="gs://"+e),e=removeTrailingSlash(e))),exports.bucketFilePath=((e,...s)=>(e=removeTrailingSlash(e),s=s.map(e=>removeTrailingSlash(removeLeadingSlash(e))),e+"/"+path.join(...s))),exports.bucketFolderPath=((e,...s)=>exports.bucketFilePath(e,...s)+"/");const removeLeadingSlash=e=>"/"===e[0]?e.substring(1,e.length):e,removeTrailingSlash=e=>"/"===e[e.length-1]?e.substring(0,e.length-1):e;